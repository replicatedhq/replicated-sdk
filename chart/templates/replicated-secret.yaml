{{- if not (and .Values.existingSecret .Values.existingSecret.name) }}
{{- $values := include "replicated.values" . | fromYaml -}}
apiVersion: v1
kind: Secret
metadata:
  labels:
    {{- include "replicated.labels" . | nindent 4 }}
  {{- if $values.commonAnnotations }}
  annotations:
    {{- toYaml $values.commonAnnotations | nindent 4 }}
  {{- end }}
  name: {{ include "replicated.secretName" . }}
  namespace: {{ include "replicated.namespace" . | quote }}
type: Opaque
stringData:
  config.yaml: |
    license: {{- $values.license | toYaml | indent 4 }}
    licenseFields:
      {{- include "replicated.licenseFields" . | nindent 6 }}
    appName: {{ $values.appName | default "" | quote }}
    channelID: {{ $values.channelID | default "" | quote }}
    channelName: {{ $values.channelName | default "" | quote }}
    {{- if $values.channelSequence }}
    channelSequence: {{ $values.channelSequence }}
    {{- end }}
    {{- if $values.releaseSequence }}
    releaseSequence: {{ $values.releaseSequence }}
    {{- end }}
    releaseCreatedAt: {{ $values.releaseCreatedAt | default "" | quote }}
    releaseNotes: |-
      {{- $values.releaseNotes | default "" | nindent 6 }}
    versionLabel: {{ $values.versionLabel | default "" | quote }}
    replicatedAppEndpoint: {{ include "replicated.appEndpoint" . | quote }}
    {{- $releaseImages := include "replicated.releaseImages" . -}}
    {{- if $releaseImages }}
    releaseImages:
      {{- $releaseImages | nindent 6 }}
    {{- end }}
    {{- if $values.statusInformers }}
    statusInformers:
      {{- $values.statusInformers | toYaml | nindent 6 }}
    {{- else }}
    statusInformers: {{ $values.statusInformers | toYaml }}
    {{- end }}
    replicatedID: {{ $values.replicatedID | default "" | quote }}
    appID: {{ $values.appID | default "" | quote }}
    tlsCertSecretName: {{ $values.tlsCertSecretName | default "" | quote }}
    {{- if hasKey $values "reportAllImages" }}
    reportAllImages: {{ $values.reportAllImages }}
    {{- end }}
  {{- if ($values.integration).licenseID }}
  integration-license-id: {{ $values.integration.licenseID }}
  {{- end }}
  {{- if not (kindIs "invalid" ($values.integration).enabled) }}
  integration-enabled: "{{ $values.integration.enabled }}"
  {{- end }}
  {{- if ($values.integration).mockData }}
  integration-mock-data: {{- $values.integration.mockData | toYaml | indent 1 }}
  {{- end }}
{{- end }}
